<!DOCTYPE html>
<html>
<head>
	<title>Please work</title>
	<!-- CSS only -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" crossorigin="anonymous">

</head>
<body>

	<form method="POST" enctype="multipart/form-data" id="myForm">
    </form>
	<!-- Stream video via webcam -->
	<div class="container" style="margin-left: 350px;margin-top: 50px">
		<h1 style="margin-left: 20px"> Automated Waste Segregation </h1>

	<div class="video-wrap">
		<video id="video" playsinline autoplay="true" style="border: 3px solid black;"> </video>
	</div>

	<!-- Trigger canvas web API -->
	<div class="controller">
		<button id="snap" class="btn btn-primary">Capture</button>
		<input type="button" value="Submit" class="btn btn-dark" onclick="upload()">

	</div>

	<!-- Webcam video snapshot -->
	<canvas id="canvas" width="640" height="480"></canvas>
	</div>


	<script>

		'use strict';
		const video = document.getElementById('video');
		const canvas = document.getElementById('canvas');
		const snap = document.getElementById('snap');
		const errorMsgElement = document.getElementById('span#ErrorMsg');

		const constraints = {
			video :{
				width: 1280, height: 720
			}
		};


		//Access Webcam
		async function init(){
			try{
				const stream = await navigator.mediaDevices.getUserMedia(constraints);
				handleSuccess(stream);
			}
			catch(e){
				errorMsgElement.innerHTML = `navigator.getUserMedia.error:${e.toString()}`;
			}
		}

		//success
		function handleSuccess(stream){
			window.stream = stream;
			video.srcObject = stream;
		}

		//load init
		init();

		//Draw image
		var context = canvas.getContext('2d');
		snap.addEventListener("click",function () {
			context.drawImage(video, 0,0,640,480);
		});

		function upload() {
    	console.log("Uploading...")
    	var image = document.getElementById('canvas').toDataURL();
    	var form = document.getElementById('myForm');
    	var formData = new FormData(form);
    	formData.append("file", image); //key-value pair
    	var xmlhttp = new XMLHttpRequest();
    	xmlhttp.open("POST", "/handleimage");

    	// check when state changes, 
    	xmlhttp.onreadystatechange = function() {

    if(xmlhttp.readyState == 4 && xmlhttp.status == 200) {
        alert(xmlhttp.responseText);
        }
    }

    xmlhttp.send(formData);
    console.log(formData.get('file'));
    console.log(formData.get('userID'));
}

	</script>

</body>
</html>