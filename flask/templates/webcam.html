<!DOCTYPE html>
<html>
<head>
	<title>Webcam</title>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
 

</head>
<body>
	<!-- Stream video via webcam -->
	<div class="video-wrap">
		<video id="video" playsinline autoplay="true"> </video>
	</div>

	<!-- Trigger canvas web API -->
	<div class="controller">
		<button id="snap">Capture</button>
	</div>

	<!-- Webcam video snapshot -->
	<canvas id="canvas" width="640" height="480"></canvas>


	<script>

		'use strict';
		const video = document.getElementById('video');
		const canvas = document.getElementById('canvas');
		const snap = document.getElementById('snap');
		const errorMsgElement = document.getElementById('span#ErrorMsg');

		const constraints = {
			video :{
				width: 1280, height: 720
			}
		};


		//Access Webcam
		async function init(){
			try{
				const stream = await navigator.mediaDevices.getUserMedia(constraints);
				handleSuccess(stream);
			}
			catch(e){
				errorMsgElement.innerHTML = `navigator.getUserMedia.error:${e.toString()}`;
			}
		}

		//success
		function handleSuccess(stream){
			window.stream = stream;
			video.srcObject = stream;
		}

		//load init
		init();

		//Draw image
		var context = canvas.getContext('2d');
		snap.addEventListener("click",function () {
			context.drawImage(video, 0,0,640,480);

			var imgURL = canvas.toDataURL();
  			console.log(sample);
  			$.ajax({
  			  type: "POST",
  			  cache: false,
  			  url: "{{url_for('disp_pic')}}",
  			  data: imgURL,
  			  success: function(data) {
  			    if (data.success) {
  			      alert('Your file was successfully uploaded!');
  			    } else {
  			      alert('There was an error uploading your file!');
  			    }
  			  },
  			  error: function(data) {
  			    alert('There was an error uploading your file!');
  			  }
  			}).done(function() {
  			  console.log("Sent");
  			});


			/*const myCanvas = document.querySelector("#canvas");
        	const dataURI = myCanvas.toDataURL("image/png").replace("image/png", "image/octet-stream");
        	window.location.href=dataURI;*/
		});


	</script>

</body>
</html>